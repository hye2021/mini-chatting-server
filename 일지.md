# 개발 일지

## 개발 업무 내용

- [x] 기본 요구 사항 -> 이전에 진행했던 네트워크 채팅 예제 활용하여 만들기
- [x] 채팅방에 사람이 없으면 채팅방 삭제해야 함
  - [x] 삭제 했다는 메시지
  - [x] 리스트에 띄우지 않음
  - [x] 해당 채팅방에 들어갈 수 없음
- [x] /users & /roomusers
- [x] 추가 기능: 채팅 내역 저장
- [ ] 중복 닉네임 방지
- [ ] 귓속말 기능

## 업무 중 이슈/고민 또는 이슈 해결한 내용

#### 기본 요구 사항 : 채팅 내용을 입력하면 모든 사용자에게 브로드캐스트 하는 것이 아니라, 내가 속한 채팅방에 있는 사용자에게만 내용을 보내야 한다.

- 1안
  - **아이디어**
  - 처음에 생각한 것은 채팅방마다 새로운 서버 소켓을 만드는 것이었다.
  - 클라이언트가 채팅방에 들어오게 되면, 해당 채팅방의 서버 소켓에게 연결을 요청한다.
  - 해당 채팅방의 서버 소켓은 새로운 소켓을 만들어서 클라이언트와 연결한다.
  - 채팅방의 소켓과 클라이언트가 연결된 i/o stream을 모아서 컬렉션에 저장한다.
  - 채팅방이 broadcast 하는 사용자와, 채팅방에 속한 사용자의 메시지를 받는 사용자는 모두 '해당 채팅방에 속한 사용자'이다.
  - 따라서 클라이언트는 (1) 서버 로비, (2) 채팅방 서버와 각각 연결된 소켓을 가지게 된다.
  - **채택하지 않은 이유**
  - 만약 규모가 있는 프로젝트였다면 이런 방법으로 만드는 것이 오히려 쉽고 명확했을지도 모르겠다.
  - 하지만 내가 아직 소켓 프로그래밍에 대한 이해가 부족해서 그런지 이러한 방식으로 하나의 물리적 서버, 하나의 서버 프로그램에 연결하는 소켓을 두 개 만들어서 연결하는것이 올바르게 사용하는 것이 무엇인지도 모르겠고 그로인해 생길 문제점도 잘 모르겠다.
  - 서버에서 정해지지 않은 개수의 수 많은 포트를 사용해야 하는데 이러한 방식으로 포트를 사용하는 것에 문제가 있을 것 같다.. 정확히는 모르겠음
  -
- 2안 ✅
  - **아이디어**
  - 사실 이 방법을 먼저 생각했다. 내가 생각하기에 가장 쉬운 방법이고, 큰 문제점을 생각할 수 없었다.
  - 이전에 진행했던 채팅 예제에서, 브로드캐스트 하기 위해 모든 클라이언트의 output stream 데이터를 Map 컬렉션에 담았다. 그렇다면 똑같이 Map 컬렉션에 같은 내용의 데이터를 저장하되, 채팅방별로 구분해서 담고 메시지를 보내면 해당 채팅방에 속한 사람들의 output stream에만 데이터를 보내주는 것이다.

#### 모든/채팅방마다 연결된 클라이언트의 output stream을 담은 데이터 컬렉션의 종류

- 처음에는 방마다 연결된 클라이언트의 output stream 을 담은 데이터 타입을 list로 만들었다가, 빈 채팅방은 삭제하는 기능이 있어야 한다는걸 깨닫고 Map으로 변경하려고 하였다.
- 하지만 새로 생성되는 방의 번호는 무조건 최대 번호 +1 이므로 굳이 컬렉션의 종류를 변경하지 않고 참여자가 0인 채팅방의 경우 들어가지 않도록 하여 마치 삭제된 것처럼 보이도록 하는것이 기존 코드를 건드리지 않고 해결할 수 있다고 생각되어 그렇게 만들었다.

#### 채팅 내역 클라이언트 pc에 저장

- 현재 채팅 내역을 채팅방별로 구분해서 서버에 파일로 저장하고 있다. 원래 의도는 클라이언트에 저장하는 것이었는데 시간이 없어서 못해가지고 아쉬움

## 참고한 내용

## 발전할 내용

- broadcast 이벤트로 구현하려면 어떻게 해야 할까?
- 채팅방을 구분하는 방법 -> 채팅방마다 스레드를 만들어주는 방법은 어떨까?

## 기타
